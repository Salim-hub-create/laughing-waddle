<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Summarizer App</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .container {
      background: #ffffff;
      width: 90%;
      max-width: 900px;
      margin-top: 40px;
      padding: 30px;
      border-radius: 18px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.08);
      animation: fadeIn 0.4s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      font-weight: 700;
      font-size: 32px;
      margin-bottom: 6px;
      color: #202124;
    }

    p.desc {
      margin-top: -2px;
      margin-bottom: 18px;
      color: #606368;
    }

    textarea {
      width: 100%;
      height: 200px;
      padding: 15px;
      border-radius: 12px;
      border: 1px solid #d0d3d8;
      outline: none;
      font-size: 15px;
      resize: vertical;
      transition: border 0.2s;
    }
    textarea:focus {
      border: 1px solid #5b8dfd;
      box-shadow: 0 0 4px rgba(91, 141, 253, 0.25);
    }

    .controls {
      display:flex;
      gap:10px;
      margin-top:15px;
      flex-wrap:wrap;
    }

    .controls button {
      padding: 10px 16px;
      background: #5b8dfd;
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background .15s, transform .06s;
    }
    .controls button.secondary { background: #6c757d; }
    .controls button:active { transform: scale(.99); }

    .output-box {
      margin-top: 20px;
      background: #f9fafc;
      border: 1px solid #e1e3e6;
      padding: 18px;
      border-radius: 12px;
      min-height: 120px;
      font-size: 15px;
      white-space: pre-wrap;
    }

    .label {
      font-weight: 600;
      margin-top: 18px;
      margin-bottom: 8px;
      display: block;
      color: #202124;
    }

    .note {
      font-size: 13px;
      color: #7a7f85;
      margin-top: 8px;
    }

    .error {
      color: #9b2c2c;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Summarizer</h1>
    <p class="desc">Paste text, pick a mode, and get a clean result instantly. (Network errors are handled gracefully.)</p>

    <label class="label" for="inputText">Text to summarize:</label>
    <textarea id="inputText" placeholder="Paste your paragraph here..."></textarea>

    <div class="controls">
      <button id="summarizeBtn">Standard</button>
      <button id="shortBtn">Ultra‑Short</button>
      <button id="bulletBtn">Bullet Points</button>
      <button id="detailBtn">Detailed</button>
      <button id="rewriteBtn">Rewrite</button>
      <button id="clearBtn" class="secondary">Clear</button>
    </div>

    <label class="label">Summary</label>
    <div id="output" class="output-box">Nothing yet...</div>
  </div>

  <script>
    // --- CONFIG ---
    // NOTE: For demo/debugging you might set the API key here. In production, keep it on the server.
    const API_KEY = "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"; // <- if you replace it, keep it secret
    const MODEL = "tngtech/deepseek-r1t2-chimera:free";
    const API_URL = "https://openrouter.ai/api/v1/chat/completions";

    // --- UI ---
    const input = document.getElementById('inputText');
    const output = document.getElementById('output');
    const meta = document.getElementById('meta');

    function extractContentFromResponse(data) {
      // Attempt a few common paths so the code is robust to response shape.
      // OpenRouter-style: choices[0].message.content
      if (data?.choices?.[0]?.message?.content) return data.choices[0].message.content;
      // older style: choices[0].message.content (duplicate above) or choices[0].text
      if (data?.choices?.[0]?.text) return data.choices[0].text;
      // Some APIs wrap differently
      if (data?.choices?.[0]?.message) {
        const msg = data.choices[0].message;
        if (typeof msg === 'string') return msg;
        if (msg?.content) return msg.content;
      }
      return null;
    }

    async function summarize(text, mode = 'standard') {
      if (!text || !text.trim()) return 'Please enter some text to summarize.';

      const prompts = {
        standard: `Provide an extremely clear, precise summary of the following text. Keep it 2–4 sentences, focus only on essential points, and rewrite it cleanly without repeating phrases.\n\n${text}`,
        short: `Summarize the following text in ONE ultra-short sentence capturing only the core idea.\n\n${text}`,
        bullet: `Summarize the following text into 3–5 clean bullet points with no filler.\n\n${text}`,
        detailed: `Provide a structured summary of the following text with short sections for: Main Idea, Key Points, Important Details. Keep it concise and readable.\n\n${text}`,
        rewrite: `Rewrite the following text to be clearer, cleaner, and easier to read while keeping all meaning. Do NOT summarize.\n\n${text}`
      };

      // Build request body
      const body = JSON.stringify({
        model: MODEL,
        messages: [{ role: 'user', content: prompts[mode] }]
      });

      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${API_KEY}`,
            'X-Title': 'My Summarizer App'
          },
          body
        });

        if (!res.ok) {
          const errText = await res.text().catch(() => res.statusText || 'Unknown error');
          return `Request failed (${res.status}): ${errText}`;
        }

        const data = await res.json().catch(() => null);
        const content = extractContentFromResponse(data);
        if (!content) return 'No summary returned (response shape unexpected).';
        return content.trim();
      } catch (err) {
        // Common causes: network down, CORS issues, sandbox blocking external requests
        console.error('Summarize error:', err);
        return 'Network error: failed to fetch the API. This can happen due to CORS, network restrictions, or the sandbox environment blocking external requests. Try running locally with network access or use a server-side proxy.';
      }
    }

    // --- Wiring ---
    document.getElementById('summarizeBtn').addEventListener('click', async () => {
      output.textContent = 'Summarizing...';
      output.textContent = await summarize(input.value, 'standard');
    });

    document.getElementById('shortBtn').addEventListener('click', async () => {
      output.textContent = 'Summarizing...';
      output.textContent = await summarize(input.value, 'short');
    });

    document.getElementById('bulletBtn').addEventListener('click', async () => {
      output.textContent = 'Summarizing...';
      output.textContent = await summarize(input.value, 'bullet');
    });

    document.getElementById('detailBtn').addEventListener('click', async () => {
      output.textContent = 'Summarizing...';
      output.textContent = await summarize(input.value, 'detailed');
    });

    document.getElementById('rewriteBtn').addEventListener('click', async () => {
      output.textContent = 'Rewriting...';
      output.textContent = await summarize(input.value, 'rewrite');
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
      input.value = '';
      output.textContent = 'Nothing yet...';
    });

    // Developer convenience: if API key looks obviously fake/placeholder, warn in UI
    try {
      if (!API_KEY || API_KEY.startsWith('sk-') === false) {
        meta.innerText = 'Warning: API key is missing or looks invalid. Replace it with a valid key on the server for production.';
        meta.classList.add('error');
      } else {
        // We won't attempt to verify the key here to avoid accidental network calls.
      }
    } catch (e) { console.warn(e); }
  </script>
</body>
</html>
